<!DOCTYPE html>
<html lang="en">
  <head>
    <title> Alta de Contrato </title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://formden.com/static/cdn/font-awesome/4.4.0/css/font-awesome.min.css" />
    <script type="text/javascript" src="js/angular.min.js"></script>
  </head>
  <body ng-app="tatei">
    <div class="container" ng-controller="altacontratoctrl">
    <div class="modal fade bs-tatei-modal-sm" id="msload" tabindex="-1"
          role="dialog" aria-hidden="true" data-backdrop="static">
          <div class="modal-dialog modal-sm">
              <div class="modal-content">
                  <div class="modal-header">
                      <h4 class="modal-title">
                          <span class="glyphicon glyphicon-time">
                          </span>Espera un momento..
                       </h4>
                  </div>
                  <div class="modal-body">
                      <div class="progress">
                          <div class="progress-bar progress-bar-info
                          progress-bar-striped active"
                          style="width: 100%">
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <h2> Alta de Contrato </h2>
      <div class="panel panel-default">
        <div class="panel-body">
          <form action="#">
            <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="tipoContrato" class="control-label">Tipo de Contrato</label>
                            <select id="tipoContrato" class="form-control" placeholder="Tipo de Contrato" ng-model="seleccion.tipoCatalogo" ng-options="catalogo.tipoCatalogo as catalogo.descripcion for catalogo in contratos"></select>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="documento" class="control-label">Documento</label>
                            <select id="documento" class="form-control" ng-model="seleccion.tipoCatalogo" ng-options="catalogo.tipoCatalogo as catalogo.descripcion for catalogo in documentos"></select>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="numDocumento" class="control-label">Número de Documento</label>
                            <input type="text" class="form-control" id="numDocumento" placeholder="# CONTRATO">
                        </div>
                    </div>
            </div>
            <div class="row">
                <div class="col-sm-5">
                  <div class="form-group">
                    <label for="empresa" class="control-label">Empresa</label>
                    <select id="empresa" class="form-control" ng-model="seleccion.tipoCatalogo" ng-options="catalogo.tipoCatalogo as catalogo.descripcion for catalogo in empresas"></select>
                  </div>
                </div>
                  <div class="col-sm-3">
                      <label for="monto" class="control-label">Monto</label>
                      <div class="input-group">
                          <span class="input-group-addon">$</span>
                          <input type="number" class="form-control" id="monto" placeholder=" 0.00">
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="subtotal" class="control-label">Subtotal</label>
                      <div class="input-group">
                          <span class="input-group-addon">$</span>
                          <input type="number" class="form-control" id="subtotal" placeholder="0.00">
                      </div>
                  </div>
            </div>
            <div class="row">
              <div class="col-sm-3">
                <label for="fechaInicio" class="control-label">Fecha de Inicio</label>
                <div class="input-group">
                  <div class="input-group-addon"><i class="fa fa-calendar"></i></div>
                  <input class="form-control" id="fechaInicio" name="fechaInicio" placeholder="MM/DD/YYYY" type="text"/>
                </div>
              </div>
              <div class="col-sm-3">
                 <label for="fechaTermino" class="control-label">Fecha de Término</label>
                <div class="input-group">
                  <div class="input-group-addon"><i class="fa fa-calendar"></i></div>
                  <input class="form-control" id="fechaTermino" name="fechaTermino" placeholder="MM/DD/YYYY" type="text"/>
                </div>
              </div>
              <div class="col-sm-3">
                <div class="input-group">
                  <label for="diasDuracion" class="control-label">Días de duración</label>
                  <input type="number" id="diasDuracion" class="form-control" placeholder="0" disabled="true">
                </div>
              </div>
              <div class="col-sm-3">
                <label for="avance" class="control-label">Avance</label>
                <div class="input-group">
                  <span class="input-group-addon">%</span>
                  <input type="number" id="avance" class="form-control" placeholder="0.0" disabled="true">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-3">
                <label for="fechaRegistro" class="control-label">Fecha de Registro</label>
                <div class="input-group">
                  <div class="input-group-addon"><i class="fa fa-calendar"></i></div>
                  <input class="form-control" id="fechaRegistro" name="fechaRegistro" placeholder="MM/DD/YYYY" type="text" disabled="true" />
                </div>
              </div>
              <div class="col-sm-6">
                <div class="form-group">
                  <label for="vialidad" class="control-label">Vialidad</label>
                  <select id="vialidad" class="form-control" ng-model="seleccion.tipoCatalogo" ng-options="catalogo.tipoCatalogo as catalogo.descripcion for catalogo in vialidades"></select>
                </div>
              </div>
              <div class="col-sm-2">
                <!--div class="form-group">
                  <button class="btn btn-primary" style="margin: 25px;"> Nueva Vialidad</button>
                </div-->
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6">
                <div class="row">
                  <div class="col-sm-12">
                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h3 class="panel-title">Tramo Inicial</h3>
                      </div>
                      <div class="panel-body">
                        <div class="row">
                          <div class="col-sm-12">
                            <div class="form-group">
                              <label for="direccionInicial" class="control-label">Dirección</label>
                              <input type="text" id="direccionInicial" class="form-control"placeholder="Av. Gobernadores 102 Col Bugambilias">
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-sm-6">
                            <div class="form-group">
                              <label for="latitudInicial" class="control-label">Latitud</label>
                              <input type="text" id="latitudInicial" class="form-control" placeholder="-0.9999999">
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-sm-6">
                            <div class="form-group">
                              <label for="longitudInicial" class="control-label">Longitud</label>
                              <input type="text" id="longitudInicial" class="form-control" placeholder="1.2366526">
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-12">
                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h3 class="panel-title">Tramo Final</h3>
                      </div>
                      <div class="panel-body">
                        <div class="row">
                          <div class="col-sm-12">
                            <div class="form-group">
                              <label for="direccionTermino" class="control-label">Dirección</label>
                              <input type="text" id="direccionTermino" class="form-control" placeholder="Av. Morelos S/N Col 10 Abril">
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-sm-6">
                            <div class="form-group">
                              <label for="latitudTermino" class="control-label">Latitud</label>
                              <input type="text" id="latitudTermino" class="form-control" placeholder="-0.9999999">
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-sm-6">
                            <div class="form-group">
                              <label for="longitudTermino" class="control-label">Longitud</label>
                              <input type="text" id="longitudTermino" class="form-control" placeholder="1.2366526">
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="row">
                  <div class="col-sm-12">
                    <div id="map" style="width:100%; height:550px"></div> 
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-offset-4 col-sm-4"><button class="btn btn-success" style="margin: 25px;">Nueva Cuadrilla</button></div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-2">
                <label for="estatus" class="control-label">Estatus</label>
                <select id="estatus" class="form-control"><option>Activo</option><option>Inactivo</option></select>
              </div>
              <div class="col-sm-3">
                <label for="cuadrillac" class="control-label">Cuadrilla</label>
                <select id="cuadrillac" class="form-control" ng-model="seleccion.idCuadrilla" ng-options="cuadrilla.idCuadrilla as cuadrilla.nombreCuadrilla for cuadrilla in cuadrillas"></select>
              </div>
              <div class="col-sm-2">
                <label for="noPer" class="control-label">#Per</label>
                <input type="number" id="noPer" class="form-control" placeholder="0">
              </div>
              <div class="col-sm-5">
                <!-- Form Estandar -->
                <h4>Adjuntar Contrato</h4>
                  <div class="form-inline">
                    <div class="form-group">
                      <input type="file" id="adjuntarContrato">
                      <p class="help-block">Los formatos admitidos son PDF, PNG, JPG.</p>
                    </div>
                  </div>
                <!-- Zona de Drop -->
                <!--h4>Arrastrar los archivos a esta zona</h4>
                <div class="upload-drop-zone" id="drop-zone">
                  Solo arrastrar y soltar
                </div-->
              </div>
            </div>
            <div class="row">
              <div class="col-sm-offset-3"></div>
              <div class="col-sm-offset-2 col-sm-8 col-sm-offset-2">
                <div class="form-group">
                  <label for="comentarios">Comentarios</label>
                  <textarea id="comentarios" class="form-control" rows="3"></textarea>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-12">
                <div class="table-responsive">
                  <table class="table table-bordered">
                    <thead>
                      <tr class="success">
                        <td>Num</td>
                        <td>Fch Registro</td>
                        <td>Vialidad</td>
                        <td>Vialidad</td>
                        <td>Tramo Inicial</td>
                        <td>Tramo Final</td>
                        <td>Estatus</td>
                        <td></td>
                      </tr>
                    </thead>
                    <tbody>
                      <tr ng-repeat="item in items">
                        <td>{{item.X}}</td>
                        <td>{{item.X}}</td>
                        <td>{{item.X}}</td>
                        <td>{{item.X}}</td>
                        <td>{{item.X}}</td>
                        <td>{{item.X}}</td>
                        <td>{{item.X}}</td>
                        <td><button type="button" class="btn btn-info">Editar</button></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-offset-3 col-sm-2">
                <button type="button" class="btn btn-block btn-success">Alta</button>
              </div>
              <div class="col-sm-2 col-sm-offset-3">
                <button type="button" class="btn btn-block btn-warning">Guardar</button>
              </div>
            </div>
        </form>
        </div>
      </div>
      
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>

    <script>
    var medida;
      $(document).ready(function(){
        var fechaInicioForm=$('input[name="fechaInicio"]');
        var fechaTerminoForm=$('input[name="fechaTermino"]');
        var fechaRegistroForm=$('input[name="fechaRegistro"]');
        var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
        fechaInicioForm.datepicker({
          format: 'mm/dd/yyyy',
          container: container,
          todayHighlight: true,
          autoclose: true,
        })
        fechaTerminoForm.datepicker({
          format: 'mm/dd/yyyy',
          container: container,
          todayHighlight: true,
          autoclose: true,
        })
        fechaRegistroForm.datepicker({
          format: 'mm/dd/yyyy',
          container: container,
          todayHighlight: true,
          autoclose: true,
        })
      })
      var map;
      function initMap() {
        medida = {
            mvcLine: new google.maps.MVCArray(),
            mvcPolygon: new google.maps.MVCArray(),
            mvcMarkers: new google.maps.MVCArray(),
            line: null,
            polygon: null
        };
        var mx1 = {lat: 19.34751544463381, lng: -98.98272888210454};
        var mx2 = {lat: 19.38962144393955, lng: -99.04332534816899};
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 10,
          center: mx1
        });
        var marker = new google.maps.Marker({
          position: mx1,
          map: map
        });
        var marker = new google.maps.Marker({
          position: mx2,
          map: map
        });
        google.maps.event.addListener(map, 'click', function(event) {
            setPoint(event.latLng);
        });
      }

        var markers = [];

        //initialize();

        function initialize() {
          var myOptions = {
            zoom: 10,
            center: new google.maps.LatLng(100.090, -100.536),
            mapTypeId: google.maps.MapTypeId.ROADMAP
          }
          map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

          addMarker(new google.maps.LatLng(100.0747, -100.6274), "Tramo Inicial");
          addMarker(new google.maps.LatLng(100.0758, -100.6254), "Tramo Final");

        }

        function addMarker(latlng, titulo) {
          markers.push(new google.maps.Marker({
            position: latlng, 
            map: map,
            title: titulo,
            icon: "http://maps.google.com/mapfiles/marker" + String.fromCharCode(markers.length + 65) + ".png"
          }));    
        }

        var app = angular.module('tatei', []);

        app.controller('altacontratoctrl', function ($scope, $http) {
          $('#msload').modal('show');
          $http({
                  method: 'GET',
                  url: 'http://localhost:8080/CuadrillasWEB/ConsultaCatalogo',
                  params: {
                    'tipoCatalogo': 'CONTR_TIPO'
                  },
                  data: { }
            }).then(function successfn(result) {
              $scope.contratos = result.data.catalogo;
                    console.log(result);
                     $('#msload').modal('hide');
            }, function errorfn(response) {
                console.error(response);
                alert(response.data.header.mensajeFuncional);
                $('#msload').modal('hide');
                //$('#msgerror').val(response.data.header.mensajeFuncional);
            });

          $('#msload').modal('show');
          $http({
                  method: 'GET',
                  url: 'http://localhost:8080/CuadrillasWEB/ConsultaCatalogo',
                  params: {
                    'tipoCatalogo': 'DOCUMENTO'
                  },
                  data: { }
            }).then(function successfn(result) {
                  $scope.documentos = result.data.catalogo;
                    console.log(result);
                     $('#msload').modal('hide');
            }, function errorfn(response) {
                console.error(response);
                alert(response.data.header.mensajeFuncional);
                $('#msload').modal('hide');
                //$('#msgerror').val(response.data.header.mensajeFuncional);
            });

            $('#msload').modal('show');
            $http({
                    method: 'GET',
                    url: 'http://localhost:8080/CuadrillasWEB/ConsultaCatalogo',
                    params: {
                      'tipoCatalogo': 'EMPRESAS'
                    },
                    data: { }
              }).then(function successfn(result) {
                    $scope.empresas = result.data.catalogo;
                      console.log(result);
                       $('#msload').modal('hide');
              }, function errorfn(response) {
                  console.error(response);
                  alert(response.data.header.mensajeFuncional);
                  $('#msload').modal('hide');
                  //$('#msgerror').val(response.data.header.mensajeFuncional);
              });

            $('#msload').modal('show');
            $http({
                    method: 'GET',
                    url: 'http://localhost:8080/CuadrillasWEB/ConsultaCatalogo',
                    params: {
                      'tipoCatalogo': 'VIALIDAD'
                    },
                    data: { }
              }).then(function successfn(result) {
                    $scope.vialidades = result.data.catalogo;
                      console.log(result);
                       $('#msload').modal('hide');
              }, function errorfn(response) {
                  console.error(response);
                  alert(response.data.header.mensajeFuncional);
                  $('#msload').modal('hide');
                  //$('#msgerror').val(response.data.header.mensajeFuncional);
              });

              $('#msload').modal('show');
            $http({
                    method: 'GET',
                    url: 'http://localhost:8080/CuadrillasWEB/ConsultaCuadrilla',
                    params: {
                    },
                    data: { }
              }).then(function successfn(result) {
                    $scope.cuadrillas = result.data.cuadrilla;
                      console.log(result);
                       $('#msload').modal('hide');
              }, function errorfn(response) {
                  console.error(response);
                  alert(response.data.header.mensajeFuncional);
                  $('#msload').modal('hide');
                  //$('#msgerror').val(response.data.header.mensajeFuncional);
              });

        });
        function setPoint(latLng) {
            var marker = new google.maps.Marker({map: map, position: latLng, draggable: true});
            medida.mvcLine.push(latLng);
            medida.mvcPolygon.push(latLng);
            medida.mvcMarkers.push(marker);
            var latLngIndex = medida.mvcLine.getLength() - 1;
            google.maps.event.addListener(marker, "drag", function(evt) {
                medida.mvcLine.setAt(latLngIndex, evt.latLng);
                medida.mvcPolygon.setAt(latLngIndex, evt.latLng);
            });
            google.maps.event.addListener(marker, "dragend", function() {
                if (medida.mvcLine.getLength() > 1) {
                    compute_length();
                }
            });

            //mLineaRecta();
        }

        function mLineaRecta() {
            if (medida.mvcLine.getLength() > 1) {
                if (!medida.line) {
                    medida.line = new google.maps.Polyline({
                        map: map,
                        clickable: false,
                        strokeColor: "#FF0000",
                        strokeOpacity: 1,
                        strokeWeight: 3,
                        path: medida.mvcLine
                    });
                }

                if (medida.mvcPolygon.getLength() > 2) {

                    if (medida.polygon != null)
                    {
                        medida.polygon.setMap(null);
                    }

                    if (length_mode != "distance")
                    {
                        medida.polygon = new google.maps.Polygon({
                            clickable: false,
                            map: map,
                            fillOpacity: 0.25,
                            strokeOpacity: 0,
                            paths: medida.mvcPolygon
                        });
                    }
                    else
                    {
                        medida.polygon = new google.maps.Polygon({
                            clickable: false,
                            map: map,
                            fillOpacity: 0.0,
                            strokeOpacity: 0,
                            paths: medida.mvcPolygon
                        });
                    }
                }
            }
            if (medida.mvcLine.getLength() > 1) {
                compute_length();
            }
        }

    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCRhFISVoNopLoDLd5dTHlgVjEgLvKPokc&libraries=geometry&callback=initMap"></script>
  </body>
</html>
