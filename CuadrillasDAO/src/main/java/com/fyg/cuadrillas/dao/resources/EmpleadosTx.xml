<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.fyg.cuadrillas.dao.resources.EmpleadosTx">

<!-- Registra en la tabla Empleado -->
<insert id="registraEmpleado" parameterType="empleado" useGeneratedKeys="true" keyProperty="id_empleado"  keyColumn="id_empleado">
INSERT INTO empleado(nombre,apellido_pat,apellido_mat,sexo,rfc,rfc_calculado,curp,fecha_nacimiento,
fecha_ingreso,codigo_puesto,codigo_vialidad,codigo_area,codigo_talla,sueldo,nss,no_credito_infonavit,
telefono,fecha_alta,fecha_baja,codigo_tipo_salida,codigo_causa_salida,fecha_ult_mod,estatus,observaciones)
VALUES(#{nombre},#{apellido_pat},#{apellido_mat},#{sexo},#{rfc},#{rfc_calculado},#{curp},#{fecha_nacimiento},
now(),#{codigo_puesto},#{codigo_vialidad},#{codigo_area},#{codigo_talla},#{sueldo},#{nss},#{no_credito_infonavit},
#{telefono},now(),now(),#{codigo_tipo_salida},#{codigo_causa_salida},now(),#{estatus},#{observaciones})
<selectKey keyProperty="id_empleado" resultType="Integer" order="AFTER">
SELECT LAST_INSERT_ID();
</selectKey>
</insert>

<insert id="registraDocumentos" parameterType="empleadoDocumentos">
INSERT INTO empleado_documentos(id_empleado,codigo_emp_doc,fecha_alta,fecha_ult_mod,estatus)
VALUES 
<foreach collection="list" item="element" index="index" separator=",">
 (#{element.id_empleado},#{element.codigo_emp_doc},now(),now(),#{element.estatus}) 
</foreach>
</insert>

<update id="bajaEmpleado" parameterType="empleado">
UPDATE empleado SET
     fecha_baja = now(),
     codigo_tipo_salida = #{codigo_tipo_salida},
     codigo_causa_salida = #{codigo_causa_salida},
     fecha_ult_mod = now(),
     estatus = #{estatus}
 WHERE id_empleado = #{id_empleado}
</update id="modificaEmpleado" parameterType="empleado">
UPDATE empleado SET 
        nombre = #{nombre},
        apellido_pat = #{apellido_pat},
        apellido_mat = #{apellido_mat}
        fecha_nacimiento = #{fecha_nacimiento},
        sexo = #{sexo},
        rfc = #{rfc},
        rfc_calculado = #{rfc_calculado}
 WHERE id_empleado = #{id_empleado}
<delete id="eliminaDocumentos" parameterType="empleadoDocumentos">
DELETE FROM empleado_documentos WHERE id_empleado = #{id_empleado}
</delete>
</mapper>