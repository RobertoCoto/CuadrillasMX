<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper	namespace="com.fyg.cuadrillas.dao.CuadrillaNTx">

<resultMap type="Cuadrilla" id="cuadrilla" >
<result column="id_cuadrilla" property="idCuadrilla"/>
<result column="nombre_cuadrilla" property="nombreCuadrilla"/>
<result column="codigo_vialidad" property="codigoVialidad"/>
<result column="numero_personas" property="numeroPersonas"/>
<result column="nombre_vialidad" property="nombreVialidad"/>
</resultMap>

<select id="existeMismaCuadrilla" parameterType="Cuadrilla" resultType="int">
SELECT count(nombre_cuadrilla) AS nombre_cuadrilla
FROM cuadrilla
WHERE nombre_cuadrilla = #{nombreCuadrilla}
</select>

<select id="existeMismaIdCuadrilla" parameterType="Cuadrilla" resultType="int">
SELECT count(id_cuadrilla) AS id_cuadrilla
FROM cuadrilla
WHERE id_cuadrilla = #{idCuadrilla}
</select>

<select  id="existeBajaCuadrilla" parameterType="Cuadrilla" resultType="int">
SELECT count(estatus) AS estatus
FROM cuadrilla
WHERE id_cuadrilla = #{idCuadrilla}
AND estatus = 'I'
</select>

<select id="consultaCuadrilla" parameterType="Cuadrilla" resultMap="cuadrilla">
	SELECT c.id_cuadrilla, 
		   c.nombre_cuadrilla,
		   c.codigo_vialidad,
		   c.calificacion,
		   c.estatus,ca.descripcion AS nombre_vialidad,
		   count(e.id_empleado) AS numero_personas
	FROM cuadrilla c
	LEFT JOIN empleado e ON e.id_cuadrilla = c.id_cuadrilla AND e.estatus = 'A'
	LEFT JOIN catalogo ca ON c.codigo_vialidad = ca.codigo
	WHERE c.estatus = 'A' 
	GROUP BY c.id_cuadrilla, 
		   c.nombre_cuadrilla
</select>
</mapper>